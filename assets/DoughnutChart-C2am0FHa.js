import{j as h}from"./jsx-runtime-u17CrQMm.js";import{r as u}from"./iframe-BnCQc_Yu.js";import"./periods-BueKGNxC.js";const O=e=>{const o=e.reduce((r,s)=>r+s.value,0);if(o===0)return e.map(r=>({label:r.label,percentage:0,color:r.color}));const t=e.map(r=>({label:r.label,color:r.color,percentage:Math.round(r.value/o*100)})),n=t.reduce((r,s)=>r+s.percentage,0);if(n<100){const r=100-n;for(let s=0;s<r;s++)t[s].percentage++}else if(n>100){const r=n-100;for(let s=0;s<r;s++)t[s].percentage>0&&t[s].percentage--}return t},U=e=>_.MAX_DOUGHTNUT_ANGLE*(e/100),b=(e,o,t)=>{const n=e/180*Math.PI,r=Math.PI/2-n,s=o*Math.cos(r)+t,a=-o*Math.sin(r)+t;return{x:s,y:a}},L=(e,o,t,n)=>{const s=o-e>180?1:0,{x:a,y:i}=b(e,t,n),{x:A,y:T}=b(o,t,n);return`M ${a} ${i} A ${t} ${t} 0 ${s} 1 ${A} ${T}`},C=e=>{try{const t=e.startsWith("var(")?getComputedStyle(document.documentElement).getPropertyValue(e.slice(4,-1).trim()).trim().slice(1):e.slice(1);return parseInt(t,16)>10066329?"var(--color-grey-900)":"var(--color-grey-0)"}catch{return"var(--color-grey-900)"}},I=["var(--color-brand-500)","var(--color-brand-300)","var(--color-brand-200)","var(--color-brand-100)","var(--color-brand-50)","var(--color-grey-100)"],_={ANIMATION_DURATION:800,TOTAL_RADIUS:180,CLIP_RADIUS:100,MIN_PERCENTAGE_FOR_LABEL:5,LABEL_Y_OFFSET:9,MAX_DOUGHTNUT_ANGLE:359.99},S=({chartData:e,donutRadius:o,totalRadius:t,minPercentageForLabel:n})=>{const r=u.useRef([]),s=u.useRef([]),a=u.useMemo(()=>O(e),[e]),i=u.useMemo(()=>a.reduce((l,c,m)=>{const g=U(c.percentage),p=l.cumulativeAngle,f=l.cumulativeAngle+g,D=(p+f)/2,E=c.color??I[m%I.length];return l.segments.push({startAngle:p,endAngle:f,midAngle:D,color:E,label:c.label,percentage:c.percentage}),l.cumulativeAngle+=g,l},{segments:[],cumulativeAngle:0}).segments,[a]),A=u.useCallback(l=>{l.forEach((c,m)=>{const g=r.current[m],p=s.current[m],f=i[m];if(g){const D=L(c.startAngle,c.endAngle,o,t);g.setAttribute("d",D)}if(p&&f&&f.percentage>=n){const{x:D,y:E}=b(c.midAngle,o,t);p.setAttribute("x",Math.round(D).toString()),p.setAttribute("y",Math.round(E+_.LABEL_Y_OFFSET).toString()),p.setAttribute("opacity",c.labelOpacity.toString())}})},[i,o,t,n]),T=u.useCallback((l,c)=>{r.current[l]=c},[]),d=u.useCallback((l,c)=>{s.current[l]=c},[]);return{segments:i,onFrame:A,setSegmentRef:T,setLabelRef:d}},x=e=>e*(2-e),R=(e,o,t)=>e+(o-e)*t,v=(e,o)=>{const t=u.useRef([]),n=u.useRef(null),r=u.useRef(0),s=u.useCallback(()=>{const a=[...t.current];if(a.length!==e.length){for(;a.length<e.length;)a.push({startAngle:0,endAngle:0,midAngle:0,labelOpacity:0});a.splice(e.length)}const i=A=>{r.current===0&&(r.current=A);const T=A-r.current,d=x(Math.min(1,T/o.duration)),l=e.map((c,m)=>({startAngle:R(a[m].startAngle,c.startAngle,d),endAngle:R(a[m].endAngle,c.endAngle,d),midAngle:R(a[m].midAngle,c.midAngle,d),labelOpacity:d}));if(t.current=l,o.onFrame(l),d>=1){r.current=0;return}n.current=requestAnimationFrame(i)};r.current=0,n.current=requestAnimationFrame(i)},[e,o]);u.useEffect(()=>{if(e.length!==0)return n.current&&(cancelAnimationFrame(n.current),n.current=null),s(),()=>{n.current&&cancelAnimationFrame(n.current)}},[e,s])},N=({ref:e,label:o,textColor:t})=>h.jsxs("text",{ref:e,x:0,y:0,opacity:0,fill:t,textAnchor:"middle",fontSize:"24px",fontWeight:600,children:[o,"%"]});N.__docgenInfo={description:"",methods:[],displayName:"DoughnutLabel",props:{ref:{required:!0,tsType:{name:"Ref",elements:[{name:"SVGTextElement"}],raw:"Ref<SVGTextElement>"},description:""},label:{required:!0,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""},textColor:{required:!0,tsType:{name:"string"},description:""}}};const y=({ref:e,color:o,strokeWidth:t,path:n})=>h.jsx("path",{ref:e,d:n??"",opacity:1,stroke:o,strokeWidth:t,fill:"none"});y.__docgenInfo={description:"",methods:[],displayName:"DoughnutSegment",props:{ref:{required:!1,tsType:{name:"Ref",elements:[{name:"SVGPathElement"}],raw:"Ref<SVGPathElement>"},description:""},color:{required:!0,tsType:{name:"string"},description:""},strokeWidth:{required:!0,tsType:{name:"number"},description:""},path:{required:!1,tsType:{name:"string"},description:""}}};const F=({title:e,chartData:o,animationDuration:t=_.ANIMATION_DURATION,totalRadius:n=_.TOTAL_RADIUS,clipRadius:r=_.CLIP_RADIUS,minPercentageForLabel:s=_.MIN_PERCENTAGE_FOR_LABEL})=>{const a=n*2,i=n-r,A=r+i/2,T=u.useId(),{onFrame:d,segments:l,setLabelRef:c,setSegmentRef:m}=S({chartData:o,donutRadius:A,totalRadius:n,minPercentageForLabel:s});return v(l,{onFrame:d,duration:t}),h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${a} ${a}`,"aria-labelledby":T,children:[h.jsx("title",{id:T,children:e}),h.jsx(y,{color:"var(--color-grey-100)",strokeWidth:i,path:L(0,_.MAX_DOUGHTNUT_ANGLE,A,n)}),l.map((g,p)=>h.jsxs("g",{children:[h.jsx(y,{ref:f=>m(p,f),color:g.color,strokeWidth:i}),g.percentage>=s&&h.jsx(N,{ref:f=>c(p,f),label:g.percentage,textColor:C(g.color)})]},g.label))]})};F.__docgenInfo={description:"",methods:[],displayName:"DoughnutChart",props:{title:{required:!0,tsType:{name:"string"},description:""},chartData:{required:!0,tsType:{name:"Array",elements:[{name:"DoughnutChartItem"}],raw:"DoughnutChartItem[]"},description:""},animationDuration:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.ANIMATION_DURATION",computed:!0}},totalRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.TOTAL_RADIUS",computed:!0}},clipRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.CLIP_RADIUS",computed:!0}},minPercentageForLabel:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.MIN_PERCENTAGE_FOR_LABEL",computed:!0}}}};export{F as D,I as R};
